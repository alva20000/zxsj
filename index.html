<!DOCTYPE html>
<html>
<head>
  <title>极简组队系统</title>
  <link href="https://cdn.jsdelivr.net/npm/@mdi/font@6.x/css/materialdesignicons.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/vuetify@3.x/dist/vuetify.min.css" rel="stylesheet">
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vuetify@3.x/dist/vuetify.umd.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.0.2/firebase-firestore-compat.js"></script>
</head>
<body>
  <div id="app">
    <v-app>
      <v-main>
        <v-container>
          <!-- 创建队伍表单 -->
          <v-card class="mb-4">
            <v-card-title>创建新队伍</v-card-title>
            <v-card-text>
              <v-select v-model="newParty.dungeon" :items="dungeons" label="选择副本"></v-select>
              <v-combobox v-model="newParty.requiredRoles" :items="roles" label="需求职业" multiple chips></v-combobox>
              <v-btn color="primary" @click="createParty">创建</v-btn>
            </v-card-text>
          </v-card>

          <!-- 队伍列表 -->
          <v-card v-for="party in parties" :key="party.id" class="mb-2">
            <v-card-title>
              {{ party.dungeon }} 
              <v-chip color="green" v-if="isPartyOpen(party)" class="ml-2">招募中</v-chip>
              <v-chip color="red" v-else class="ml-2">已满员</v-chip>
            </v-card-title>
            <v-card-text>
              <v-chip v-for="role in party.requiredRoles" :key="role" class="ma-1" @click="joinParty(party.id, role)">
                {{ role }} ({{ countRoles(party.members, role) }}/1)
              </v-chip>
              <div class="mt-2">成员：{{ party.members.join(', ') || '暂无' }}</div>
            </v-card-text>
          </v-card>
        </v-container>
      </v-main>
    </v-app>
  </div>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "YOUR_PROJECT.firebaseapp.com",
  projectId: "YOUR_PROJECT",
  storageBucket: "YOUR_PROJECT.appspot.com",
  messagingSenderId: "1234567890",
  appId: "1:1234567890:web:abcdef123456"
};

// 初始化 Firebase
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore(app);

const { createApp } = Vue;

createApp({
  data() {
    return {
      dungeons: ['黑龙巢穴', '熔火之心', '纳克萨玛斯'],
      roles: ['坦克', '治疗', '近战DPS', '远程DPS'],
      newParty: { dungeon: null, requiredRoles: [] },
      parties: []
    }
  },
  mounted() {
    // 实时监听队伍数据
    db.collection('parties').onSnapshot(snapshot => {
      this.parties = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
    });
  },
  methods: {
    async createParty() {
      await db.collection('parties').add({
        dungeon: this.newParty.dungeon,
        requiredRoles: this.newParty.requiredRoles,
        members: [],
        timestamp: firebase.firestore.FieldValue.serverTimestamp()
      });
      this.newParty = { dungeon: null, requiredRoles: [] };
    },
    async joinParty(partyId, role) {
      const partyRef = db.collection('parties').doc(partyId);
      const party = (await partyRef.get()).data();
      
      if (this.countRoles(party.members, role) < 1) {
        await partyRef.update({
          members: [...party.members, `${role}:${prompt('请输入你的游戏ID')}`]
        });
      }
    },
    countRoles(members, role) {
      return members.filter(m => m.startsWith(role)).length;
    },
    isPartyOpen(party) {
      return party.requiredRoles.some(role => 
        this.countRoles(party.members, role) < 1
      );
    }
  }
}).use(Vuetify).mount('#app');
</script>
</body>
</html>